name: Cl

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Update sources.list
      run: |
        sudo sed -i 's#http://azure.archive.ubuntu.com/ubuntu/#https://archive.kali.org/#g' /etc/apt/sources.list
        sudo apt update

    - name: Download KasmVNC Server
      run: wget https://github.com/kasmtech/KasmVNC/releases/download/v1.3.0/kasmvncserver_jammy_1.3.0_amd64.deb

    - name: Install KasmVNC Server
      run: sudo apt-get install ./kasmvncserver_*.deb

    - name: Add user to ssl-cert group
      run: sudo addgroup $USER ssl-cert

    - name: Start VNC server session
      run: vncserver -1 -admin -password@10210

    - name: Start VNC session with Mate desktop environment
      run: vncserver -select-de mate

    - name: Add new user with read/write permissions
      run: vncpasswd -u my_username -w -r

    - name: Tail VNC logs
      run: tail -f ~/.vnc/*.log

    - name: List current VNC sessions
      run: vncserver -list

    - name: Kill VNC session with display ID :2
      run: vncserver -kill :2

    - name: Show IP address
      run: |
        ip addr show

    - name: Delay for 1 hour
      run: sleep 3600
