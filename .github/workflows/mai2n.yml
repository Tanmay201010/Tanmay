name: Kasm Install with Telebit

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Download and install Telebit
    - name: Download and install Telebit
      run: |
        curl https://get.telebit.io/ | bash
        sudo mv ~/telebit /usr/local/bin/

    # Change directory to the home directory
    - name: Change directory to home directory
      run: cd $HOME

    # Manually edit xstartup
    - name: Manually edit xstartup
      run: |
        # Instructions to manually edit the xstartup file
        # You may need to open the file in a text editor and make the necessary changes

    # Troubleshoot select-de.sh
    - name: Troubleshoot select-de.sh
      run: |
        # Investigate why select-de.sh is failing to execute
        # Check for any errors in the script or missing dependencies

    # Download Kasm release archive
    - name: Download Kasm release archive
      run: |
        cd $HOME
        curl -O https://kasm-static-content.s3.amazonaws.com/kasm_release_1.15.0.06fdc8.tar.gz

    # Extract Kasm release archive
    - name: Extract Kasm release archive
      run: |
        cd $HOME
        tar -xf kasm_release_1.15.0.06fdc8.tar.gz

    # Run Kasm installation script with 'yes' response
    - name: Run Kasm installation script with 'yes' response
      run: |
        yes | sudo bash $HOME/kasm_release/install.sh

    # Provide Telebit details and start tunnel at port 443
    - name: Provide Telebit details and start tunnel at port 443
      run: |
        echo -e "peyisa6677@hisotyr.com" | /usr/local/bin/telebit http 443 &

    # Display IP address
    - name: Display IP address
      run: ip addr show

    # Delay for 1 hour
    - name: Delay for 1 hour
      run: sleep 3600
